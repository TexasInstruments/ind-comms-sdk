<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>EtherNet/IP™ Adapter: Description of the EtherNet/IP Adapter Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="ReleaseNotes.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
     <tr style="height: 40px;">
         <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg" /></a></td>
         <td id="projectalign"><div id="projectname"> EtherNet/IP™ Adapter<span id="projectnumber">3.02.00</span></div></td>
         <td id="projectbrief" align="right"><img src=EtherNetIP.png /></a></td>
         <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
     </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('eip_quickstart_example_app.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Description of the EtherNet/IP Adapter Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#eip_exampleScope">Scope</a></li>
<li class="level1"><a href="#eip_exampleMain">Main Application</a></li>
<li class="level1"><a href="#exampleAppInit">EtherNet/IP Adapter Application Initialization</a></li>
<li class="level1"><a href="#examplePRUInit">PRU Initialization</a></li>
<li class="level1"><a href="#exampleCreateCallbacks">Create Callback Functions for predefined CIP Objects</a></li>
<li class="level1"><a href="#exampleCipSetup">Create Vendor specific Content and Callback Functions for predefined CIP Objects</a></li>
<li class="level1"><a href="#exampleCipGenerateContent">Create Vendor specific Instances and Attributes</a></li>
<li class="level1"><a href="#exampleWebServer">Web Server Task</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="eip_exampleScope"></a>
Scope</h1>
<p>This section discusses example applications that are shipped as part of the EtherNet/IP Adapter SDK. With this release a new directory structure is introduced that allows for adding further examples demontrating basic implementations of additional device profiles according to the ODVA specifications.</p>
<p><object type="image/svg+xml" data="eipDirectoryStructureAM243.svg" style="pointer-events: none;"></object></p>
<p>At the time of release, a code example is provided for a CIP Generic Device according to <a href="index.html#vol1">Volume 1</a> of the CIP NETWORKS LIBRARY. The Generic Device profile does not specify any instances of the Assembly Object or the type of application objects necessary for device operation. This portion of the device profile must be supplied by the product developer and in this example focuses on digital I/O functionality via an LED array available on the evaluation board. The Generic Device example does not cover CIP Sync functionality.</p>
<p>The example itself is primarily implemented in the files <code>app.c</code> and <code>deviceProfiles\genericDevice\appGenericDevice.c</code> with board specific functionality located in <code>appNV.c</code> and below <code>board\am243x</code> -evm\freertos or <code>board\am243x</code> -lp\freertos.</p>
<p>A simplified implementation of a HTTP server is included in <code>appWebServer.c</code> and the associated header files.</p>
<h1><a class="anchor" id="eip_exampleMain"></a>
Main Application</h1>
<p>The primary task of main is the initialization of the Texas Instruments driver porting layer (DPL), the selection of the PRU-ICSS instance, PHY devices, and the configuration of the task priorities. After this initial setup, a task is constructed that implements the CIP and EtherNet/IP functionality.</p>
<p>This task, implemented in function <code>EI_APP_mainTask</code>, initializes and opens all peripheral drivers, depending on the SysConfig settings for the project. To enable UART console output, verify that your SysConfig settings are as follows:</p>
<p><img src="eip_am243x_syscfg.png" alt="" border="1" height="auto" class="inline"/></p>
<p>These settings result in the following code in <code>ti_drivers_open_close.c</code> including the declaration of the handle <code>gUartHandle</code> that is later used in the example code to access the UART.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * UART</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* UART Driver handles */</span></div>
<div class="line">UART_Handle gUartHandle[CONFIG_UART_NUM_INSTANCES];</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* UART Driver Parameters */</span></div>
<div class="line">UART_Params gUartParams[CONFIG_UART_NUM_INSTANCES] =</div>
<div class="line">{</div>
<div class="line">    {</div>
<div class="line">        .baudRate           = 115200,</div>
<div class="line">        .dataLength         = UART_LEN_8,</div>
<div class="line">        .stopBits           = UART_STOPBITS_1,</div>
<div class="line">        .parityType         = UART_PARITY_NONE,</div>
<div class="line"> </div>
<div class="line">        :</div>
<div class="line">        :</div>
<div class="line">        :</div>
</div><!-- fragment --><p>In <code>EI_APP_maintTask</code> (appGenericDevice.c) CUST_DRIVERS_init is called to initialize different drivers suh as QSPI, I2C, and UART. Furthermore a corresponding callback function for UART output can registered by calling <code>OSAL_registerPrintOut</code>. In the callback function strings are then written to the console output by calling <code>UART_write</code> from the Texas Instruments driver library:</p>
<div class="fragment"><div class="line">OSAL_registerPrintOut(NULL, EI_APP_osPrintfCb);</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="keywordtype">void</span> EI_APP_osPrintfCb(<span class="keywordtype">void</span>* pContext_p, <span class="keyword">const</span> <span class="keywordtype">char</span>* __restrict pFormat_p, va_list argptr_p)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* @cppcheck_justify{unusedVariable} false-positive: variable is used */</span></div>
<div class="line">    <span class="comment">//cppcheck-suppress unusedVariable</span></div>
<div class="line">    int32_t transferOK;</div>
<div class="line">    <span class="comment">/* @cppcheck_justify{unusedVariable} false-positive: variable is used */</span></div>
<div class="line">    <span class="comment">//cppcheck-suppress unusedVariable</span></div>
<div class="line">    UART_Transaction transaction;</div>
<div class="line"> </div>
<div class="line">    OSALUNREF_PARM(pContext_p);</div>
<div class="line"> </div>
<div class="line">    UART_Transaction_init(&amp;transaction);</div>
<div class="line"> </div>
<div class="line">    memset(aOutStream_s, 0, <span class="keyword">sizeof</span>(aOutStream_s));</div>
<div class="line">    (void)vsnprintf(aOutStream_s, <span class="keyword">sizeof</span>(aOutStream_s), pFormat_p, argptr_p);</div>
<div class="line"> </div>
<div class="line">    transaction.count = strlen(aOutStream_s);</div>
<div class="line">    transaction.buf = (<span class="keywordtype">void</span> *)aOutStream_s;</div>
<div class="line">    transaction.args = NULL;</div>
<div class="line">    transferOK = UART_write(gUartHandle[CONFIG_UART_CONSOLE], &amp;transaction);</div>
<div class="line"> </div>
<div class="line">    (void)transferOK;</div>
<div class="line">}</div>
</div><!-- fragment --><p><code>EI_APP_mainTask</code> then proceeds with executing <code>EI_APP_init</code> to set up the EtherNet/IP Adapter. After the initialization, it enters a loop that cyclically processes the Ethernet/IP stack.</p>
<p>The <code>main</code> entry point is implemented in <code>app.c</code> and the <code>EI_APP_mainTask</code> function in <code>appGenericDevice.c</code>.</p>
<p><object type="image/svg+xml" data="eipAdapterGenericDevice0x2Brevision3.2.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="exampleAppInit"></a>
EtherNet/IP Adapter Application Initialization</h1>
<p>In the <code>EI_APP_init</code> initialization function, calls to the EtherNet/IP adapter API are made the create the internal structures required by the EtherNet/IP stack. <code><a class="el" href="group___e_i___a_p_i___a_d_p___b_a_s_i_c_ga4d6ca65985bdd2a098c29cbf6a98a76d.html#ga4d6ca65985bdd2a098c29cbf6a98a76d" title="Create a new EtherNet/IP adapter.">EI_API_ADP_new</a></code> creates the new adapter, and in <code><a class="el" href="group___e_i___a_p_i___a_d_p___b_a_s_i_c_gada79aa0df7c93eca89107b80186e534e.html#gada79aa0df7c93eca89107b80186e534e" title="Set the stack error handler function.">EI_API_ADP_setErrorHandlerFunc</a></code> the stack error handler is registered.</p>
<p>Based on the definition of TIME_SYNC in the predefined symbols section of Code Composer Studio support for the Time Sync functionality will become available. Depending on an equivalent test for QUICK_CONNECT quickconnect functionality will be enabled.</p>
<p>After further application specific initialization, a new CIP node is created by calling <code><a class="el" href="group___e_i___a_p_i___c_i_p___n_o_d_e_ga55eef73ef010e7b89a39bdf9a297b1dd.html#ga55eef73ef010e7b89a39bdf9a297b1dd" title="Create a new CIP node.">EI_API_CIP_NODE_new</a></code>. Note that this function must be called after <code><a class="el" href="group___e_i___a_p_i___a_d_p___b_a_s_i_c_ga4d6ca65985bdd2a098c29cbf6a98a76d.html#ga4d6ca65985bdd2a098c29cbf6a98a76d" title="Create a new EtherNet/IP adapter.">EI_API_ADP_new</a></code>.</p>
<p><code>EI_APP_init</code> is implemented in <code>app.c</code>.</p>
<p><object type="image/svg+xml" data="eipAppInit.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="examplePRUInit"></a>
PRU Initialization</h1>
<p>The function <code>EI_APP_stackInit</code> performs initialization and starting of the PRU firmware. This function is implemented in <code>app.c</code>.</p>
<p><object type="image/svg+xml" data="eipAppStackInit.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="exampleCreateCallbacks"></a>
Create Callback Functions for predefined CIP Objects</h1>
<p><code>EI_APP_cipCreateCallback</code> creates callback functions for non-volatile data storage and for reset services. Note that the callback function itself taking care of non-volatile data is implemented in <code>appNV.c</code>.</p>
<p><object type="image/svg+xml" data="eipAppCipCreateCallback.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="exampleCipSetup"></a>
Create Vendor specific Content and Callback Functions for predefined CIP Objects</h1>
<p>Finally, CIP specific content, such as classes, instances, attributes, and assemblies, is created in <code>EI_APP_cipSetup</code>. Together with <code>EI_APP_cipGenerateContent</code> this function will be that requires adaptation by the end user, depending on the device functionality that is to be implemented.</p>
<p>Also, the created attributes are added to the assemblies for cyclic CIP IO data exchange.</p>
<p><object type="image/svg+xml" data="eipAppCipSetup.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="exampleCipGenerateContent"></a>
Create Vendor specific Instances and Attributes</h1>
<p><object type="image/svg+xml" data="eipAppCipGenerateContent.svg" style="pointer-events: none;" height="auto"></object></p>
<h1><a class="anchor" id="exampleWebServer"></a>
Web Server Task</h1>
<p>Starting with version 2.1, the EtherNet/IP stack contains an example how to implement a small HTTP server application. The corresonding code can be found in the files <code>appWebServer.c</code>, <code>appWebServer.h</code>, and appWebServerData.h. The HTML definitions for the page layout are contained in appWebServerData.h.</p>
<p>The web server and the corresponding background task are enabled by adding <code>CPU_LOAD_MONITOR == 1</code> to the list of predefined symbols in Code Composer Studio. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
