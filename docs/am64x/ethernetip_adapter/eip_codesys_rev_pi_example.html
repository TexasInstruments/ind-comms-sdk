<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.7"/>
<title>EtherNet/IP™ Adapter: CODESYS Runtime on a KUNBUS RevPi Controller</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="ReleaseNotes.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
     <tr style="height: 40px;">
         <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg" /></a></td>
         <td id="projectalign"><div id="projectname"> EtherNet/IP™ Adapter<span id="projectnumber">3.04.02</span></div></td>
         <td id="projectbrief" align="right"><img src=EtherNetIP.png /></a></td>
         <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
     </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.7 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('eip_codesys_rev_pi_example.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">CODESYS Runtime on a KUNBUS RevPi Controller</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#quickstart_example_plc_codesys_installation">CODESYS Installation</a></li>
<li class="level1"><a href="#quickstart_example_plc_codesys">Creating a CODESYS Project</a></li>
<li class="level1"><a href="#quickstart_example_plcRevPi_st">Implementing the PLC Code in Structured Text</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="quickstart_example_plc_codesys_installation"></a>
CODESYS Installation</h1>
<p>The CODESYS development system is available for download free of charge after registration with the <a href="https://store.codesys.com/de/codesys.html">CODESYS Store</a>. Please consult the system requirements in the CODESYS Store for the development PC. It is recommended to install the full package.</p>
<p>For the CODESYS runtime on the KUNBUS RevPi hardware, the <a href="https://store.codesys.com/de/codesys-control-for-raspberry-pi-mc-sl.html">CODESYS Control for Raspberry Pi MC SL</a> is required. Without a valid license, the CODESYS runtime including the fieldbus functionality will execute for one hour and then exit. To install the runtime package the CODESYS development system must be started with administrative rights. Installation is performed from within the CODESYS Package Manager or the CODESYS Installer. It is recommended to install the multi-core version.</p>
<p>Start the CODESYS Installer with Administrator privileges. Identify your CODESYS installation and select Change.</p>
<p><img src="CODESYS Installer.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>Under AddOns, select the Browse tab and search for Raspberry. Check the line with CODESYS Control for Raspberry PI and install the package.</p>
<p><img src="CODESYS Installer Raspberry PI.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>After the package is installed, the CODESYS runtime system must be installed on the RevPi hardware. From the menu system select Tools &rarr; Update Raspberry Pi</p>
<p><img src="CODESYS_UpdatePi.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Select the matching CODESYS Runtime Package and click install. To verify that the installation has been successful, select System info.</p>
<h1><a class="anchor" id="quickstart_example_plc_codesys"></a>
Creating a CODESYS Project</h1>
<p>Start the CODESYS development system and create a new standard project</p>
<p><img src="CODESYS_New_Project.png" alt="" height="auto" class="inline"/></p>
<p>Select <code>CODESYS Control for Raspberry Pi MC SL (3S - Smart Software Solutions GmbH)</code> as device and the programming language of your choice.</p>
<p><img src="CODESYS_Standard_Project.png" alt="" height="auto" class="inline"/></p>
<p>The development system creates the project structure and populates the structure of the device tree.</p>
<p><img src="CODESYS_Project.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Before configuring the EtherNet/IP network, the matching device description file must be installed into the CODESYS device repository. Navigate to Tools &rarr; Device Repository in the menu system and install the  file <code>am64x-evm_tiEtherNetIP_freeRTOS.eds</code>  which  is  part of the distribution.</p>
<p><img src="CODESYS_Device_Repository.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>In the device tree, double click on Device to open the Device tab in the central workspace.</p>
<p><img src="CODESYS_Scan_Network.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Perform a Scan Network and select the corresponding device in the Select Device dialog.</p>
<p><img src="CODESYS_Select_Devices.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>Right-clicking on Device in the project tree and add an Ethernet interface to the Device</p>
<p><img src="CODESYS_Add_Device_Ethernet_Interface.png" alt="" width="600px" height="auto" border="1" class="inline"/><br  />
</p>
<p><img src="CODESYS_Add_Device_EtherNet.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>In the device tree double-click on Ethernet to open the Network interface configuration and click on Browse to select the Network interface (in the diagram above port B, eth1) that is connected to your EtherNet/IP Adapter device.</p>
<p><img src="CODESYS_Configure_Ethernet.png" alt="" width="600px" height="auto" class="inline"/><br  />
</p>
<p><img src="CODESYS_Select_Network_Adapter.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>Continue to add an EtherNet/IP Scanner to the Ethernet device.</p>
<p><img src="CODESYS_Add_Scanner.png" alt="" height="auto" class="inline"/></p>
<p>Once complete you can build your project, enter Online mode and start your application. This only starts the EtherNet/IP Scanner from where it is possible to scan for connected Adapter devices.</p>
<p><img src="CODESYS_Scan_Devices.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Provided the device description has been installed earlier, the scan process will identify the EtherNet/IP Adapter device which can now be copied to the project.</p>
<p><img src="CODESYS_Copy_to_Project.png" alt="" width="600px" height="auto" class="inline"/></p>
<p>The final project structure now looks as shown below:</p>
<p><img src="CODESYS_Project_final.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Finally, exit Online mode, re-enter Online mode to download the new project structure, and start the application.</p>
<p><img src="CODESYS_EtherNetIP_running.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>All devices are running, and you can continue with implementing your IEC 61131-3 program.</p>
<h1><a class="anchor" id="quickstart_example_plcRevPi_st"></a>
Implementing the PLC Code in Structured Text</h1>
<p>The EtherNet/IP Adapter example for  AM64x  implements a vendor specific object with class ID 0x0070 and attributes in the vendor specific index ranges following 0x0300. Attributes at index 0x0300 to 0x0304 are added to a producing assembly, at index 0x0308 to 0x030C to a consuming assembly. Of those, the attribute at index 0x0308 is linked to an LED array on the  AM64x  evaluation kit.</p>
<p>Below a simple PLC program coded in Structured Test is demonstrated that controls this LED array.</p>
<p>Start with double clicking on PLC_PRG in the project browser. An empty PLC_PRG opens in the central workspace, that by default contains the frame for the variable declaration on top and the programming area below.</p>
<p><img src="CODESYS_Empty_Program.png" alt="" width="600px" height="auto" border="1" class="inline"/></p>
<p>Modify the variable declaration as illustrated below:</p>
<div class="fragment"><div class="line">PROGRAM PLC_PRG</div>
<div class="line">VAR</div>
<div class="line">    iCounter    : UDINT;</div>
<div class="line">    i           : USINT;</div>
<div class="line">    </div>
<div class="line">    tCycle      : TIME := T#200MS;</div>
<div class="line">    </div>
<div class="line">    bToggleOn   : BOOL := TRUE;</div>
<div class="line">    bToggleOff  : BOOL;</div>
<div class="line"> </div>
<div class="line">    fbTOn       : TON;</div>
<div class="line">    fbTOff      : TON;</div>
<div class="line">    </div>
<div class="line">    usiOutput   : USINT;</div>
<div class="line">    usiInput    : USINT;</div>
<div class="line">END_VAR</div>
</div><!-- fragment --><p>Also create a Global Variable List by right-clicking on Application &rarr; Add Object &rarr; Global Variable List... Add one variable <code>usiVisuOut</code>.</p>
<div class="fragment"><div class="line">{attribute <span class="stringliteral">&#39;qualified_only&#39;</span>}</div>
<div class="line">VAR_GLOBAL</div>
<div class="line">    usiVisuOut  : USINT;</div>
<div class="line">END_VAR</div>
</div><!-- fragment --><p>The timer function block TON, which is included in the Standard Library, implements a turn-on delay. When the input gets TRUE, first a time (<code>tCycle / 2</code>) must elapse until also the output is set to TRUE. The example uses two such timers that alternate their states. Once the second timer elapses, a counter variable is incremented, which is then used to set the output on the target device.</p>
<p>Enter the code below into the programming section of PLC_PRG:</p>
<div class="fragment"><div class="line">fbTOn(IN := bToggleOn, PT := tCycle / 2);</div>
<div class="line"> </div>
<div class="line">IF fbTOn.Q THEN</div>
<div class="line">    bToggleOn := FALSE;</div>
<div class="line">    bToggleOff := TRUE;</div>
<div class="line">END_IF</div>
<div class="line"> </div>
<div class="line">fbTOff(IN := bToggleOff, PT := tCycle / 2);</div>
<div class="line"> </div>
<div class="line">IF fbTOff.Q THEN</div>
<div class="line">    bToggleOff := FALSE;</div>
<div class="line">    bToggleOn := TRUE;</div>
<div class="line">    </div>
<div class="line">    iCounter := iCounter + 1;</div>
<div class="line">END_IF</div>
<div class="line"> </div>
<div class="line">i := TO_USINT(iCounter MOD 8);</div>
<div class="line">usiOutput := TO_USINT(EXPT(2, i));</div>
<div class="line">GVL.usiVisuOut := usiInput;</div>
</div><!-- fragment --><p>Next, the connections of the EtherNet/IP adapter device need to be configured. Double-click on EtherNet_IP_tm_Adapter in the Device tree. This opens the tab enabling the configuration of the example EtherNet/IP Adapter device. Under Connections, the requested packet interval (RPI) can be set:</p>
<p><img src="CODESYS_RPI_Setting.png" alt="" width="600px" height="auto" border="0" class="inline"/></p>
<p>Under EtherNet/IP I/O Mapping the variables of the PLC_PRG are assigned to input or output channels declared for the Adapter device in the corresponding EDS file.</p>
<p>Double-click in the variable column in the Output1 row to start the Input Assistant.</p>
<p><img src="CODESYS_Start_Input_Assistant.png" alt="" width="600px" height="auto" border="0" class="inline"/></p>
<p>In the Input Assistant select <code>usiOutput</code> and confirm with OK.</p>
<p><img src="CODESYS_Input_Assistant.png" alt="" width="600px" height="auto" border="0" class="inline"/></p>
<p>The project configuration is now finalized and can be downloaded to the CODESYS control on the Revolution PI. Login to the Revolution PI again to download the application, start the application, and note the activity on the LED array. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.9.7 </li>
  </ul>
</div>
</body>
</html>
